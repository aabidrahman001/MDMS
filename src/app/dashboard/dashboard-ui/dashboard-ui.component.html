<div class="content-wrapper" *ngIf="!loading">

  <h2 class="section-title">Dashboard Analytics</h2>

  <div class="kpi-grid">
    <div class="kpi-card">
      <p>Total Meters</p>
      <h1>{{ totalMeters }}</h1>
    </div>

    <div class="kpi-card online">
      <p>Online</p>
      <h1>{{ onlineMeters }}</h1>
    </div>

    <div class="kpi-card maintenance">
      <p>Maintenance</p>
      <h1>{{ underMaintenance }}</h1>
    </div>

    <div class="kpi-card offline">
      <p>Offline</p>
      <h1>{{ offlineMeters }}</h1>
    </div>

    <div class="kpi-card alerts">
      <p>Active Alerts</p>
      <h1>{{ activeAlerts }}</h1>
    </div>
  </div>

  <div class="charts-grid">

    <div class="chart-card">
      <h3>Meter Status</h3>
      <canvas id="statusChart"></canvas>
    </div>

    <div class="chart-card">
      <h3>Meters by Region</h3>
      <canvas id="regionChart"></canvas>
    </div>

    <div class="chart-card full">
      <h3>Hourly Load (kWh)</h3>
      <canvas id="loadChart"></canvas>
    </div>

    <div class="chart-card metrics">
      <h3>Power Quality & Carbon Avoided</h3>
      <div class="metric-item">
        <p>Carbon Avoided (kg)</p>
        <h2>{{ carbonAvoided }}</h2>
      </div>
      <div class="metric-item">
        <p>Power Quality Score</p>
        <h2>{{ powerQuality }}%</h2>
      </div>
      <div class="metric-item">
        <p>Pending Commands</p>
        <h2>{{ pendingCmd }}</h2>
      </div>
      <div class="metric-item">
        <p>Executed Today</p>
        <h2>{{ executedToday }}</h2>
      </div>
      <div class="metric-item">
        <p>Failed Today</p>
        <h2>{{ failedToday }}</h2>
      </div>
    </div>

  </div>

  <h3 class="section-subtitle">Recent Alerts</h3>
  <div class="table-container">
    <table class="alert-table">
      <thead>
      <tr>
        <th>Title</th>
        <th>Type</th>
        <th>Severity</th>
        <th>Region</th>
        <th>Time</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let a of recentAlerts">
        <td>{{ a.title }}</td>
        <td>{{ a.type }}</td>
        <td [class.severe]="a.type === 'meter-stale'">High</td>
        <td>{{ a.region }}</td>
        <td>{{ a.timestamp | date:'short' }}</td>
      </tr>
      </tbody>
    </table>
  </div>

</div>

<div class="loading-box" *ngIf="loading">
  <div class="spinner"></div>
  <p>Loading dashboard...</p>
</div>
